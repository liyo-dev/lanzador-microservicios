<div class="config-page">
  <section class="page-shell app-surface" [class.loading]="loading">
    <header class="page-header">
      <div>
        <h1 class="page-title">Configuraci√≥n de Microservicios</h1>
        <p class="page-subtitle">
          Define rutas, puertos y variables globales antes de lanzar tus servicios.
        </p>
      </div>
      <div class="header-actions">
        <button class="ghost-btn" (click)="goToHome()" title="Inicio">
          <span class="emoji">üè†</span>
        </button>
        <button class="ghost-btn" (click)="goToLauncher()" title="Ir al launcher">
          <span class="emoji">üöÄ</span>
        </button>
        <button class="ghost-btn" (click)="goToUsers()" title="Usuarios Portal">
          <span class="emoji">üë•</span>
        </button>
        <button class="ghost-btn" (click)="goToPorts()" title="Gesti√≥n de Puertos">
          <span class="emoji">üîå</span>
        </button>
        <button class="primary-btn" (click)="save()" title="Guardar configuraci√≥n">
          <span class="emoji">üíæ</span>
          Guardar todo
        </button>
        <button class="danger-btn" (click)="clear()" title="Borrar configuraci√≥n">
          <span class="emoji">üóëÔ∏è</span>
        </button>
      </div>
    </header>

    <div class="tab-panel" *ngIf="!loading">
      <div class="tabs">
        <button
          class="tab-btn"
          [class.active]="selectedTab === 'angular'"
          (click)="changeTab('angular')"
        >
          <img src="assets/logoAngular.png" alt="Angular" />
          <span>Angular</span>
        </button>
        <button
          class="tab-btn"
          [class.active]="selectedTab === 'spring'"
          (click)="changeTab('spring')"
        >
          <img src="assets/logoSpring.png" alt="Spring" />
          <span>Spring</span>
        </button>
      </div>

      <div class="tab-info">
        <h2>
          {{ selectedTab === 'angular' ? 'Fronts Angular' : 'Servicios Spring' }}
        </h2>
        <p>
          {{ selectedTab === 'angular'
            ? 'Configura rutas locales, puertos y proveedores legacy para los diferentes fronts.'
            : 'Mant√©n tus rutas de compilaci√≥n y variables globales actualizadas antes de ejecutar.'
          }}
        </p>
      </div>
    </div>

    <div class="content-area" *ngIf="!loading">
      <aside class="sidebar">
        <div class="card">
          <div class="card-header">
            <h3>Microservicios personalizados</h3>
            <button class="ghost-btn" (click)="toggleAddMicroForm()" [attr.aria-expanded]="showAddMicroForm">
              <span class="emoji">{{ showAddMicroForm ? '‚ûñ' : '‚ûï' }}</span>
            </button>
          </div>
          <p class="card-description">
            A√±ade rutas espec√≠ficas que no est√©n en la lista predeterminada. Puedes eliminarlas cuando ya no sean necesarias.
          </p>

          <form class="add-form" *ngIf="showAddMicroForm" (ngSubmit)="addCustomMicroservice()">
            <label>
              <span>Nombre del microservicio</span>
              <input
                [(ngModel)]="newMicroName"
                name="microName"
                type="text"
                maxlength="50"
                placeholder="Ej: portal-cliente"
              />
            </label>
            <label>
              <span>Tipo</span>
              <select [(ngModel)]="newMicroType" name="microType">
                <option value="angular">Angular</option>
                <option value="spring">Spring</option>
              </select>
            </label>
            <div class="form-actions">
              <button type="submit" class="primary-btn">
                <span class="emoji">‚úÖ</span>
                A√±adir
              </button>
              <button type="button" class="ghost-btn" (click)="toggleAddMicroForm()">
                Cancelar
              </button>
            </div>
          </form>
        </div>

        <div class="card insights">
          <h3>Tips r√°pidos</h3>
          <ul>
            <li>Usa rutas absolutas para evitar errores al lanzar los servicios.</li>
            <li>Los puertos solo se guardan para microservicios Angular.</li>
            <li>El bot√≥n de borrar restablece toda la configuraci√≥n a los valores por defecto.</li>
          </ul>
        </div>
      </aside>

      <section class="main-panel">
        <div class="feedback-zone">
          <div *ngIf="guardadoOK" class="alert success">‚úÖ Configuraci√≥n guardada correctamente.</div>
          <div *ngIf="borradoOK" class="alert warning">üóëÔ∏è Configuraci√≥n eliminada.</div>
        </div>

        <div class="micro-grid" *ngIf="selectedTab === 'angular'">
          <article class="micro-card" *ngFor="let micro of angularMicros" [attr.data-key]="micro.key">
            <header>
              <h3>{{ micro.label }}</h3>
              <button
                *ngIf="micro.isCustom"
                class="ghost-btn danger"
                (click)="removeCustomMicroservice(micro.key, 'angular')"
                title="Eliminar microservicio personalizado"
              >
                üóëÔ∏è
              </button>
            </header>
            <label>
              <span>Ruta local</span>
              <input [(ngModel)]="config.angular[micro.key].path" type="text" placeholder="Ruta del microservicio" />
            </label>
            <label>
              <span>Puerto</span>
              <input [(ngModel)]="config.angular[micro.key].port" type="number" placeholder="Puerto" />
            </label>
          </article>
        </div>

        <div class="spring-layout" *ngIf="selectedTab === 'spring'">
          <article class="spring-card">
            <header>
              <h3>Configuraci√≥n global</h3>
              <button class="ghost-btn" (click)="toggleSpringConfig()">
                {{ showSpringConfig ? 'Ocultar' : 'Mostrar' }}
              </button>
            </header>
            <div class="spring-form" *ngIf="showSpringConfig">
              <label>
                <span>JAVA_HOME</span>
                <input [(ngModel)]="config.spring.javaHome" type="text" placeholder="Ej: C:\\Java\\jdk1.8" />
              </label>
              <label>
                <span>MAVEN_HOME</span>
                <input [(ngModel)]="config.spring.mavenHome" type="text" placeholder="Ej: C:\\Herramientas\\apache-maven" />
              </label>
              <label>
                <span>settings.xml</span>
                <input [(ngModel)]="config.spring.settingsXml" type="text" placeholder="Ej: C:\\.m2\\settings.xml" />
              </label>
              <label>
                <span>Repositorio .m2</span>
                <input [(ngModel)]="config.spring.m2RepoPath" type="text" placeholder="Ej: C:\\Users\\usuario\\.m2\\repository" />
              </label>
            </div>
          </article>

          <div class="micro-grid">
            <article class="micro-card" *ngFor="let micro of springMicros" [attr.data-key]="micro.key">
              <header>
                <h3>{{ micro.label }}</h3>
                <button
                  *ngIf="micro.isCustom"
                  class="ghost-btn danger"
                  (click)="removeCustomMicroservice(micro.key, 'spring')"
                  title="Eliminar microservicio personalizado"
                >
                  üóëÔ∏è
                </button>
              </header>
              <label>
                <span>Ruta del microservicio</span>
                <input [(ngModel)]="config.spring[micro.key].path" type="text" placeholder="Ruta del microservicio" />
              </label>
            </article>
          </div>
        </div>
      </section>
    </div>
  </section>

  <app-spinner *ngIf="loading"></app-spinner>
</div>
